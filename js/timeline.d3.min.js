(function(m){var b=m.aa={};b.cursor={};b.cursor.i=function(e,c){this.data=c.data;this.I=e.append("g").a("x",c.c).a("clip-path","url(#clip)").a("width",c.width).a("height",c.height).a("class","cursor");this.cursor=this.I.append("g").a("width",c.width).a("height",c.height);this.Y=this.cursor.append("line").a("x1",0).a("y1",0).a("x2",0).a("y2",c.height-c.d+c.d/3).a("class","line");this.w=this.cursor.append("text").a("x",5).text(moment.t(c.start).format("MMMM")).a("class","date");this.w.a("y",c.height-
(c.d-this.w.Q().U().height));for(var a=c.b.f(),b=0;b<a.length;b++)this.cursor.append("text").a("class","lane").a("id","lane"+b).a("x",5).a("y",c.p(b)+c.g/2).a("visibility","hidden");var f=this.I,d=this.cursor,k=this.w;d3.select(window).R("mousemove.timeline",function(){var a=d3.Z(f.Q()),b=c.e.W(a[0]);k.text(moment.t(b).format("MMMM"));d.l("text.lane").a("visibility","hidden");c.o.l("rect").filter(function(a){return a.start<b&&(null==a.end||b<=a.end)}).N(function(a){d.select("#lane"+c.b.f().indexOf(a.n)).text(a.id).a("visibility",
"visible")});d.a("transform","translate("+a[0]+", 0)").l("text").N(function(){var l=this.V(),b=5;a[0]+l+10>c.width&&(b=-l-5);d3.select(this).a("x",b)})});return this};b.h={};b.h.i=function(e,c,a,h,f){f.c||(f.c=40);f.d||(f.d=40);this.width=c;this.height=a;this.c=f.c;this.d=f.d;this.j=e.append("g").a("width",this.width).a("height",this.height).a("class","viewver");this.data=h;this.start=b.L(this.data);this.end=b.J(this.data);var d=d3.set();d3.f(h).forEach(function(a){!1===d.P(a.n)&&d.add(a.n)});this.b=
d;this.g=(this.height-this.d)/this.b.f().length;this.e=d3.scale.D().domain([this.start,this.end]).F([this.c,c]);this.p=d3.scale.D().domain([0,this.b.f().length]).F([0,this.height-this.d]);d=this.b.f();for(e=0;e<d.length;e++)c=this.j.append("g").a("transform","translate(0, "+this.p(e)+")").a("width",this.width).a("height",this.g).a("class","lane"+(e%2?"Odd":"Even")),c.append("rect").a("x",0).a("y",0).a("width",this.width).a("height",this.g),c.append("text").text(d[e]).a("class","laneLabel").a("x",
10).a("y",this.g/2);this.j.append("clipPath").a("id","clip").append("rect").a("x",this.c).a("width",this.width-this.c).a("height",this.height);this.o=this.j.append("g").a("clip-path","url(#clip)").a("x",this.c).a("width",this.width).a("height",this.height).a("class","events");this.k=this.j.append("g").a("clip-path","url(#clip)").a("width",this.width).a("height",a).a("class","legend");this.k.append("line").a("x1",this.width).a("y1",0).a("x2",this.width).a("y2",this.k.a("height")).a("class","border");
this.k.append("line").a("x1",this.c).a("y1",1).a("x2",this.width).a("y2",1).a("class","border");this.k.append("line").a("x1",this.c).a("y1",this.height-this.d).a("x2",this.width).a("y2",this.height-this.d).a("class","border");this.k.append("line").a("x1",this.c).a("y1",this.height-2*(this.d/3)).a("x2",this.width).a("y2",this.height-2*(this.d/3)).a("class","border");this.k.append("line").a("x1",this.c).a("y1",this.height).a("x2",this.width).a("y2",this.height).a("class","border");this.cursor=b.cursor.i(this.j,
this);this.display=function(){for(var c=moment.t(this.start),e=moment.t(this.end);c.X(e);){var d=c.format("X"),l=this.e(d),d=this.k.append("g").a("id",d).a("class","year dynamic").a("transform","translate("+l+", 0)");d.append("line").a("x1",0).a("y1",0).a("x2",0).a("y2",this.k.a("height"));d.append("text").text(c.format("YYYY")).a("class","year").a("x",10).a("y",a-10);c.add("years",1)}var f=this,h=b.v.i(this.b.f());this.o.l(".event").data(this.data).O().append("rect").a("x",function(a){return f.s(a)}).a("y",
function(a){return f.C(a)}).a("height",function(a){return f.B(a)}).a("width",function(a){return f.r(a)}).a("class",function(a){return"event "+h.K(a)})};this.refresh=function(a,c){this.start=a;this.end=c;this.e.domain([this.start,this.end]);this.o.l("rect");var b=this;this.o.l("rect").a("x",function(a){return b.s(a)}).a("width",function(a){return b.r(a)});this.k.l("g.dynamic").a("transform",function(){return"translate("+b.e(d3.select(this).a("id"))+", 0)"})};this.s=function(a){return this.e(a.start)};
this.C=function(a){return this.p(this.b.f().indexOf(a.n))+(this.g-0.75*this.g)/2};this.r=function(a){return this.e(a.end)-this.e(a.start)};this.B=function(){return 0.75*this.g};return this};b.m={};b.m.bind=function(b){this.h=b;return this};b.m.i=function(e,c,a,h,f,d){this.width=c-h;this.height=a;this.j=e.append("g").a("transform","translate("+h+", "+f+")").a("width",this.width).a("height",this.height).a("class","explorer");this.data=d;this.start=b.L(this.data);this.end=b.J(this.data);var k=d3.set();
d3.f(d).forEach(function(a){!1===k.P(a.n)&&k.add(a.n)});this.b=k;this.g=this.height/this.b.f().length;this.e=d3.scale.D().domain([this.start,this.end]).F([0,this.width]);this.p=d3.scale.D().domain([0,this.b.f().length]).F([0,this.height]);var g=this,m=b.v.i(this.b.f());this.j.append("rect").a("width",this.width).a("height",this.height).a("class","panel");g=this;this.u=d3.G.u().x(this.e).R("brush",function(){if(g.h){var a=g.u.T();0<a[1]-a[0]&&g.h.refresh(a[0],a[1])}});this.o=this.j.append("g");this.j.append("g").a("class",
"brush").call(this.u).l("rect").a("x",0).a("y",0).a("height",this.height);this.display=function(){this.o.l(".event").data(this.data).O().append("rect").a("x",function(a){return g.s(a)}).a("y",function(a){return g.C(a)}).a("height",function(a){return g.B(a)}).a("width",function(a){return g.r(a)}).a("class",function(a){return m.K(a)});return this};this.s=function(a){return this.e(a.start)};this.C=function(a){return this.p(this.b.f().indexOf(a.n))+(this.g-0.75*this.g)/2};this.r=function(a){return this.e(a.end)-
this.e(a.start)};this.B=function(){return 0.75*this.g};return this};b.v={};b.v.i=function(b){this.M=this.index=0;this.b=b;this.K=function(c){var a=this.b.indexOf(c.n);a!=this.index&&(this.M=0,this.index=a);a="lane"+a+" "+(this.M++%2?"eventOdd":"eventEven");c.S&&(a+=" dead");return a};return this};b.i=function(e,c,a){a||(a={});a.width||(a.width=960);a.q||(a.q=400);a.A||(a.A=100);a.H||(a.H="timeline");this.G=d3.select(c).append("svg").a("x",0).a("y",0).a("width",a.width).a("height",a.q+a.A).a("class",
a.H);this.h=b.h.i(this.G,a.width,a.q,e,a.h?a.h:{});this.m=b.m.i(this.G,a.width,a.A,this.h.c,a.q,e,a.m?a.m:{}).bind(this.h);this.display=function(){this.h.display();this.m.display()};return this.display()};b.L=function(b){return moment.t(d3.min(b,function(b){return b.start})).$("year").format("X")};b.J=function(b){var c=moment().format("X");return d3.max(b,function(a){a.end||(a.end=c);return a.end})}})(d3);
